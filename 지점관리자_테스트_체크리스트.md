# ✅ 지점 관리자 기능 테스트 체크리스트

**테스트 날짜:** ___________  
**테스터:** ___________  
**버전:** 2.0

---

## 📋 테스트 환경 준비

### ✅ 1. Supabase 데이터베이스 업데이트

```sql
-- supabase-branch-manager-update.sql 실행 확인
```

- [ ] SQL 스크립트 실행 완료
- [ ] `users` 테이블에 `managed_branch` 컬럼 추가 확인
- [ ] `roles` 테이블에 `branch_manager` 역할 추가 확인
- [ ] RLS 정책 생성 확인

**확인 명령:**
```sql
-- 컬럼 확인
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'users' AND column_name = 'managed_branch';

-- 역할 확인
SELECT * FROM roles WHERE name = 'branch_manager';

-- RLS 정책 확인
SELECT policyname FROM pg_policies 
WHERE tablename IN ('users', 'leave_requests');
```

---

### ✅ 2. 코드 업데이트 확인

- [ ] `js/role-manager.js` 업데이트 (branch_manager 역할 추가)
- [ ] `js/permission-manager.js` 생성
- [ ] `js/employee-management.js` 업데이트 (지정 UI)
- [ ] `js/approval.js` 업데이트 (권한 필터링)
- [ ] `employee-management.html` 스크립트 추가
- [ ] `approval.html` 스크립트 추가
- [ ] `styles/employee-management.css` 스타일 추가

---

### ✅ 3. 테스트 데이터 준비

#### 필요한 데이터:
- [ ] 관리자 계정 1개
- [ ] 일반 직원 계정 3개 이상 (서로 다른 지점)
- [ ] 지점 2개 이상
- [ ] 연차 신청 데이터 각 지점별 2건 이상

**예시 구조:**
```
관리자: admin@company.com (전체 권한)

강남점:
- 김철수 (일반 직원 → 지점 관리자로 변경 예정)
- 이영희 (일반 직원)

영등포점:
- 박민수 (일반 직원)
- 최수진 (일반 직원)
```

---

## 🧪 기능 테스트

### ✅ 4. 지점 관리자 지정 (관리자 권한)

#### 4-1. 관리자 로그인
- [ ] 관리자 계정으로 로그인 성공
- [ ] 상단 네비게이션에 "메인관리" 메뉴 표시 확인

#### 4-2. 직원 관리 페이지 접속
- [ ] "메인관리" → "직원관리" 클릭
- [ ] 직원 목록 정상 표시
- [ ] 각 직원의 현재 역할 표시 확인

#### 4-3. 지점 관리자 지정 버튼 확인
- [ ] 각 직원 행에 🛡️ (방패) 아이콘 표시
- [ ] 관리자만 버튼이 보이는지 확인
- [ ] 마우스 오버 시 툴팁 "지점 관리자 지정" 표시

#### 4-4. 지점 관리자 지정 모달
- [ ] 🛡️ 아이콘 클릭 시 모달 열림
- [ ] 직원 정보 정확히 표시 (이름, 지점, 부서)
- [ ] "역할 선택" 드롭다운에 5개 역할 표시
  - [ ] 관리자
  - [ ] 매니저
  - [ ] 지점 관리자
  - [ ] 팀장
  - [ ] 일반 사용자
- [ ] "지점 관리자" 선택 시 "관리할 지점" 필드 표시
- [ ] "관리할 지점" 드롭다운에 모든 지점 표시
- [ ] 기본값: 직원의 현재 지점으로 선택됨
- [ ] 권한 안내 메시지 표시 확인

#### 4-5. 지점 관리자 저장
- [ ] "역할: 지점 관리자", "관리할 지점: 강남점" 선택
- [ ] [저장] 버튼 클릭
- [ ] 성공 메시지 표시: "○○○님을 지점 관리자(강남점)로 지정했습니다."
- [ ] 모달 자동 닫힘
- [ ] 직원 목록 새로고침
- [ ] 해당 직원의 역할이 "지점 관리자 (강남점)"로 표시

#### 4-6. 데이터 확인
**LocalStorage 확인 (개발자 도구 → Application → Local Storage):**
```javascript
const users = JSON.parse(localStorage.getItem('users'));
const branchManager = users.find(u => u.role === 'branch_manager');
console.log(branchManager);
// 출력 예상:
// {
//   id: "...",
//   role: "branch_manager",
//   managedBranch: "강남점",
//   ...
// }
```
- [ ] `role` 필드가 "branch_manager"로 저장됨
- [ ] `managedBranch` 필드가 "강남점"으로 저장됨

**Supabase 확인 (SQL Editor):**
```sql
SELECT id, username, role, managed_branch 
FROM users 
WHERE role = 'branch_manager';
```
- [ ] Supabase에도 동일하게 저장됨

---

### ✅ 5. 지점 관리자 로그인 및 권한 테스트

#### 5-1. 로그아웃 및 지점 관리자 로그인
- [ ] 관리자 로그아웃
- [ ] 지점 관리자(김철수) 계정으로 로그인
- [ ] 로그인 성공

#### 5-2. 네비게이션 메뉴 확인
- [ ] "연차현황" 메뉴 표시
- [ ] "캘린더" 메뉴 표시
- [ ] "메인관리" 메뉴 표시
- [ ] "마이페이지" 메뉴 표시

**메인관리 서브메뉴 확인:**
- [ ] "승인관리" 표시 ✅ (접근 가능)
- [ ] "직원관리" 숨김 ❌ (접근 불가)
- [ ] "지점관리" 숨김 ❌ (접근 불가)
- [ ] "통계" 표시 ✅ (접근 가능)
- [ ] "설정" 숨김 ❌ (접근 불가)

---

### ✅ 6. 승인 관리 페이지 (지점 관리자)

#### 6-1. 승인 페이지 접속
- [ ] "메인관리" → "승인관리" 클릭
- [ ] 페이지 정상 로드

#### 6-2. 자동 필터링 확인
**표시되어야 하는 연차:**
- [ ] 강남점 이영희의 연차 신청 (대기중)
- [ ] 강남점 이영희의 연차 신청 (승인됨)

**표시되지 않아야 하는 연차:**
- [ ] 영등포점 박민수의 연차 신청 ❌
- [ ] 영등포점 최수진의 연차 신청 ❌

**확인 방법:**
```javascript
// 개발자 도구 콘솔에서 실행
const requests = window.dataManager.leaveRequests;
const filtered = window.permissionManager.filterByBranch(requests);
console.log('전체:', requests.length);
console.log('필터링 후:', filtered.length);
console.log('필터링 결과:', filtered.map(r => r.employeeName + ' - ' + r.status));
```
- [ ] 필터링된 데이터가 강남점만 포함

#### 6-3. 승인/거절 기능
**강남점 연차 승인:**
- [ ] 이영희의 대기중인 연차 선택
- [ ] [승인] 버튼 클릭
- [ ] 성공 메시지 표시
- [ ] 상태가 "승인됨"으로 변경
- [ ] LocalStorage 및 Supabase 업데이트 확인

**다른 지점 연차 승인 시도 (예상: 불가능):**
- [ ] 영등포점 연차는 목록에 표시되지 않음 확인

#### 6-4. 검색 및 필터
- [ ] 검색 기능 정상 작동 (강남점 범위 내)
- [ ] 상태 필터 정상 작동
- [ ] 유형 필터 정상 작동
- [ ] 페이지네이션 정상 작동

---

### ✅ 7. 통계 페이지 (지점 관리자)

#### 7-1. 통계 페이지 접속
- [ ] "메인관리" → "통계" 클릭
- [ ] 페이지 정상 로드

#### 7-2. 데이터 범위 확인
- [ ] 강남점 데이터만 표시
- [ ] 영등포점 등 다른 지점 데이터 미표시
- [ ] 통계 수치가 강남점 기준으로 정확함
  - [ ] 총 직원 수
  - [ ] 총 연차 신청 수
  - [ ] 승인/대기/거절 수

---

### ✅ 8. 직원 관리 페이지 접근 제한

#### 8-1. 직접 URL 접근 시도
- [ ] 주소창에 `/employee-management.html` 입력
- [ ] 접근 차단 메시지 또는 리다이렉트 확인
- [ ] 또는 페이지는 로드되지만 데이터 조회 불가 확인

---

### ✅ 9. 마이페이지 확인

#### 9-1. 마이페이지 접속
- [ ] "마이페이지" 클릭
- [ ] 프로필 정보 표시

#### 9-2. 역할 표시 확인
- [ ] 역할: "지점 관리자" 표시
- [ ] 관리 지점: "강남점" 표시 (별도 필드 추가 시)

---

### ✅ 10. 매니저 및 관리자와의 권한 비교

#### 10-1. 매니저 로그인
- [ ] 매니저 계정으로 로그인
- [ ] 승인 페이지에서 **모든 지점** 연차 표시 확인
- [ ] 승인/거절 가능 확인

#### 10-2. 관리자 로그인
- [ ] 관리자 계정으로 로그인
- [ ] 승인 페이지에서 **모든 지점** 연차 표시 확인
- [ ] 승인/거절 가능 확인
- [ ] 직원 관리 페이지 접근 가능 확인
- [ ] 지점 관리자 지정 버튼 표시 확인

---

### ✅ 11. 역할 변경 테스트

#### 11-1. 지점 관리자 → 일반 사용자
- [ ] 관리자 로그인
- [ ] 직원 관리 페이지 접속
- [ ] 김철수 (지점 관리자) 선택
- [ ] 🛡️ 아이콘 클릭
- [ ] 역할을 "일반 사용자"로 변경
- [ ] [저장] 클릭
- [ ] 성공 메시지 표시
- [ ] 역할이 "일반"으로 변경 확인

#### 11-2. 변경 후 권한 확인
- [ ] 김철수 로그아웃
- [ ] 김철수로 다시 로그인
- [ ] 승인 페이지 접근 불가 확인 (네비게이션에서 숨김)
- [ ] 연차현황 페이지에서 본인 연차만 표시 확인

---

### ✅ 12. 복지 휴가 지급 권한

#### 12-1. 지점 관리자 로그인
- [ ] 지점 관리자(김철수) 로그인

#### 12-2. 직원 관리 페이지 (접근 불가 확인)
- [ ] 직원 관리 페이지 접근 시도
- [ ] 접근 차단 확인

**※ 복지 휴가는 직원 관리 페이지에서만 지급 가능**
- [ ] 지점 관리자는 직접 지급 불가능 확인
- [ ] 관리자 또는 매니저에게 요청해야 함

---

### ✅ 13. Supabase RLS 정책 테스트

#### 13-1. Supabase SQL Editor에서 테스트

**지점 관리자 역할로 조회:**
```sql
-- 임시로 JWT 시뮬레이션 (실제 환경에서는 자동)
-- auth.jwt()가 { "role": "branch_manager", "managed_branch": "강남점" }를 반환한다고 가정

-- 강남점 직원만 조회 가능
SELECT * FROM users WHERE branch = '강남점';

-- 강남점 연차만 조회 가능
SELECT lr.* 
FROM leave_requests lr
JOIN users u ON lr.employee_id = u.id
WHERE u.branch = '강남점';
```

#### 13-2. 애플리케이션에서 확인
- [ ] 네트워크 탭에서 Supabase API 요청 확인
- [ ] 필터링된 데이터만 반환되는지 확인

---

### ✅ 14. 엣지 케이스 테스트

#### 14-1. 지점명 변경 시
- [ ] 직원의 지점명 변경
- [ ] 지점 관리자의 관리 지점도 수동 업데이트 필요 확인

#### 14-2. 여러 지점 관리자 지정
- [ ] 강남점에 2명의 지점 관리자 지정
- [ ] 두 사람 모두 강남점 연차 조회 및 승인 가능 확인

#### 14-3. 지점 관리자 본인의 연차 신청
- [ ] 지점 관리자(김철수)가 본인의 연차 신청
- [ ] 본인이 본인 연차를 승인할 수 없음 확인 (비즈니스 로직 추가 필요 시)

#### 14-4. 빈 관리 지점
- [ ] 역할을 "지점 관리자"로 설정하지만 관리 지점 미선택
- [ ] 유효성 검사: "관리할 지점을 선택해주세요" 알림 표시 확인

---

### ✅ 15. UI/UX 테스트

#### 15-1. 스타일 확인
- [ ] 지점 관리자 뱃지 스타일 적용 (보라색 그라데이션)
- [ ] 🛡️ 아이콘 버튼 스타일 적용
- [ ] 모달 디자인 일관성 확인
- [ ] 반응형 디자인 확인 (모바일/태블릿)

#### 15-2. 사용성 확인
- [ ] 버튼 클릭 반응 속도 양호
- [ ] 로딩 인디케이터 표시 (필요 시)
- [ ] 오류 메시지 명확성
- [ ] 성공 메시지 가독성

---

### ✅ 16. 성능 테스트

#### 16-1. 대량 데이터 테스트
- [ ] 연차 신청 100건 이상 등록
- [ ] 필터링 성능 확인 (1초 이내)
- [ ] 페이지네이션 동작 확인

#### 16-2. 동시 접속 테스트
- [ ] 여러 브라우저에서 동시 로그인
- [ ] 데이터 동기화 확인 (Supabase 실시간 업데이트)

---

### ✅ 17. 보안 테스트

#### 17-1. 권한 우회 시도
- [ ] 일반 사용자가 직접 URL로 승인 페이지 접근 시도
- [ ] 네비게이션에서 메뉴 숨김 확인
- [ ] API 레벨에서도 접근 차단 확인 (Supabase RLS)

#### 17-2. 데이터 조작 시도
```javascript
// 개발자 도구 콘솔에서 실행
const fakeRequest = {
  employeeName: "박민수", // 영등포점 직원
  branch: "영등포점"
};
window.permissionManager.canApproveLeave(fakeRequest);
// 예상 결과: false
```
- [ ] 권한 없는 연차 승인 불가 확인

---

## 📊 테스트 결과 요약

### 통과율

- 총 테스트 항목: ___ / ___
- 통과: ___ 개 ✅
- 실패: ___ 개 ❌
- 건너뜀: ___ 개 ⏭️

### 발견된 이슈

| No. | 심각도 | 설명 | 재현 방법 | 상태 |
|-----|--------|------|-----------|------|
| 1 |  |  |  |  |
| 2 |  |  |  |  |
| 3 |  |  |  |  |

### 심각도 기준
- **High**: 기능 작동 불가, 시스템 오류
- **Medium**: 일부 기능 오작동, UX 문제
- **Low**: 사소한 UI 문제, 개선 사항

---

## ✅ 최종 승인

- [ ] 모든 핵심 기능 정상 작동
- [ ] 보안 테스트 통과
- [ ] 성능 테스트 통과
- [ ] UI/UX 품질 확인

**승인자:** ___________  
**승인 날짜:** ___________  
**서명:** ___________

---

**🎉 테스트 완료 후 다음 단계:**

1. ✅ 발견된 이슈 수정
2. ✅ 재테스트 수행
3. ✅ 운영 환경 배포
4. ✅ 사용자 교육 실시
5. ✅ 모니터링 시작

---

**문의:** support@offday-system.com

