// 데이터 관리자 클래스
class DataManager {
    constructor() {
        this.employees = this.loadData('employees') || [,
            {
                id: 4,
                employeeId: 1,
                employeeName: '김철수',
                startDate: '2024-02-01',
                endDate: '2024-02-03',
                days: 3,
                reason: '개인 휴가',
                status: 'pending',
                requestDate: '2024-01-28'
            },
            {
                id: 5,
                employeeId: 2,
                employeeName: '이영희',
                startDate: '2024-02-05',
                endDate: '2024-02-05',
                days: 1,
                reason: '의료진료',
                status: 'pending',
                requestDate: '2024-01-30'
            },
            {
                id: 6,
                employeeId: 3,
                employeeName: '박민수',
                startDate: '2024-02-10',
                endDate: '2024-02-12',
                days: 3,
                reason: '가족 행사',
                status: 'pending',
                requestDate: '2024-02-01'
            }
        ];
        this.leaveRequests = this.loadData('leaveRequests') || [,
            {
                id: 4,
                employeeId: 1,
                employeeName: '김철수',
                startDate: '2024-02-01',
                endDate: '2024-02-03',
                days: 3,
                reason: '개인 휴가',
                status: 'pending',
                requestDate: '2024-01-28'
            },
            {
                id: 5,
                employeeId: 2,
                employeeName: '이영희',
                startDate: '2024-02-05',
                endDate: '2024-02-05',
                days: 1,
                reason: '의료진료',
                status: 'pending',
                requestDate: '2024-01-30'
            },
            {
                id: 6,
                employeeId: 3,
                employeeName: '박민수',
                startDate: '2024-02-10',
                endDate: '2024-02-12',
                days: 3,
                reason: '가족 행사',
                status: 'pending',
                requestDate: '2024-02-01'
            }
        ];
        this.settings = this.loadData('settings') || {
            annualLeaveDays: 15,
            companyName: '우리회사',
            workingDays: ['월', '화', '수', '목', '금']
        };
        
        // 샘플 데이터가 없으면 생성
        if (this.employees.length === 0) {
            this.createSampleData();
        }
    }

    // 로컬 스토리지에서 데이터 로드
    loadData(key) {
        try {
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : null;
        } catch (error) {
            console.error('데이터 로드 오류:', error);
            return null;
        }
    }

    // 로컬 스토리지에 데이터 저장
    saveData(key, data) {
        try {
            localStorage.setItem(key, JSON.stringify(data));
            return true;
        } catch (error) {
            console.error('데이터 저장 오류:', error);
            return false;
        }
    }

    // 샘플 데이터 생성
    createSampleData() {
        const sampleEmployees = [
            {
                id: 1,
                name: '김철수',
                department: '개발팀', branch: '본사',
                position: '대리',
                email: 'kim@company.com',
                phone: '010-1234-5678',
                hireDate: '2022-01-15',
                annualLeaveDays: 15,
                usedLeaveDays: 3,
                remainingLeaveDays: 12
            },
            {
                id: 2,
                name: '이영희',
                department: '마케팅팀', branch: '강남점',
                position: '과장',
                email: 'lee@company.com',
                phone: '010-2345-6789',
                hireDate: '2021-03-20',
                annualLeaveDays: 15,
                usedLeaveDays: 7,
                remainingLeaveDays: 8
            },
            {
                id: 3,
                name: '박민수',
                department: '영업팀', branch: '부산점',
                position: '사원',
                email: 'park@company.com',
                phone: '010-3456-7890',
                hireDate: '2023-06-10',
                annualLeaveDays: 15,
                usedLeaveDays: 1,
                remainingLeaveDays: 14
            }
        ,
            {
                id: 4,
                employeeId: 1,
                employeeName: '김철수',
                startDate: '2024-02-01',
                endDate: '2024-02-03',
                days: 3,
                reason: '개인 휴가',
                status: 'pending',
                requestDate: '2024-01-28'
            },
            {
                id: 5,
                employeeId: 2,
                employeeName: '이영희',
                startDate: '2024-02-05',
                endDate: '2024-02-05',
                days: 1,
                reason: '의료진료',
                status: 'pending',
                requestDate: '2024-01-30'
            },
            {
                id: 6,
                employeeId: 3,
                employeeName: '박민수',
                startDate: '2024-02-10',
                endDate: '2024-02-12',
                days: 3,
                reason: '가족 행사',
                status: 'pending',
                requestDate: '2024-02-01'
            }
        ];

        const sampleRequests = [
            {
                id: 1,
                employeeId: 1,
                employeeName: '김철수',
                startDate: '2024-01-15',
                endDate: '2024-01-17',
                days: 3,
                reason: '가족 여행',
                status: 'pending',
                requestDate: '2024-01-10',
                approvedDate: '2024-01-11',
                approvedBy: '관리자'
            },
            {
                id: 2,
                employeeId: 2,
                employeeName: '이영희',
                startDate: '2024-01-20',
                endDate: '2024-01-20',
                days: 1,
                reason: '개인 사정',
                status: 'pending',
                requestDate: '2024-01-18'
            },
            {
                id: 3,
                employeeId: 3,
                employeeName: '박민수',
                startDate: '2024-01-25',
                endDate: '2024-01-26',
                days: 2,
                reason: '병원 진료',
                status: 'pending',
                requestDate: '2024-01-22'
            }
        ,
            {
                id: 4,
                employeeId: 1,
                employeeName: '김철수',
                startDate: '2024-02-01',
                endDate: '2024-02-03',
                days: 3,
                reason: '개인 휴가',
                status: 'pending',
                requestDate: '2024-01-28'
            },
            {
                id: 5,
                employeeId: 2,
                employeeName: '이영희',
                startDate: '2024-02-05',
                endDate: '2024-02-05',
                days: 1,
                reason: '의료진료',
                status: 'pending',
                requestDate: '2024-01-30'
            },
            {
                id: 6,
                employeeId: 3,
                employeeName: '박민수',
                startDate: '2024-02-10',
                endDate: '2024-02-12',
                days: 3,
                reason: '가족 행사',
                status: 'pending',
                requestDate: '2024-02-01'
            }
        ];

        this.employees = sampleEmployees;
        this.leaveRequests = sampleRequests;
        
        this.saveData('employees', this.employees);
        this.saveData('leaveRequests', this.leaveRequests);
    }

    // 직원 추가
    addEmployee(employee) {
        const newEmployee = {
            ...employee,
            id: this.getNextId('employees'),
            annualLeaveDays: this.settings.annualLeaveDays,
            usedLeaveDays: 0,
            remainingLeaveDays: this.settings.annualLeaveDays
        };
        
        this.employees.push(newEmployee);
        this.saveData('employees', this.employees);
        return newEmployee;
    }

    // 직원 수정
    updateEmployee(id, employeeData) {
        const index = this.employees.findIndex(emp => emp.id === id);
        if (index !== -1) {
            this.employees[index] = { ...this.employees[index], ...employeeData };
            this.saveData('employees', this.employees);
            return this.employees[index,
            {
                id: 4,
                employeeId: 1,
                employeeName: '김철수',
                startDate: '2024-02-01',
                endDate: '2024-02-03',
                days: 3,
                reason: '개인 휴가',
                status: 'pending',
                requestDate: '2024-01-28'
            },
            {
                id: 5,
                employeeId: 2,
                employeeName: '이영희',
                startDate: '2024-02-05',
                endDate: '2024-02-05',
                days: 1,
                reason: '의료진료',
                status: 'pending',
                requestDate: '2024-01-30'
            },
            {
                id: 6,
                employeeId: 3,
                employeeName: '박민수',
                startDate: '2024-02-10',
                endDate: '2024-02-12',
                days: 3,
                reason: '가족 행사',
                status: 'pending',
                requestDate: '2024-02-01'
            }
        ];
        }
        return null;
    }

    // 직원 삭제
    deleteEmployee(id) {
        this.employees = this.employees.filter(emp => emp.id !== id);
        this.leaveRequests = this.leaveRequests.filter(req => req.employeeId !== id);
        this.saveData('employees', this.employees);
        this.saveData('leaveRequests', this.leaveRequests);
    }

    // 연차 신청 추가
    addLeaveRequest(request) {
        const newRequest = {
            ...request,
            id: this.getNextId('leaveRequests'),
            requestDate: new Date().toISOString().split('T')[0],
            status: 'pending'
        };
        
        this.leaveRequests.push(newRequest);
        this.saveData('leaveRequests', this.leaveRequests);
        return newRequest;
    }

    // 연차 신청 승인/거부
    updateLeaveRequestStatus(id, status, approvedBy = '관리자') {
        const index = this.leaveRequests.findIndex(req => req.id === id);
        if (index !== -1) {
            this.leaveRequests[index].status = status;
            this.leaveRequests[index].approvedDate = new Date().toISOString().split('T')[0];
            this.leaveRequests[index].approvedBy = approvedBy;
            
            // 승인된 경우 직원의 사용 연차일 업데이트
            if (status === 'approved') {
                const request = this.leaveRequests[index];
                const employee = this.employees.find(emp => emp.id === request.employeeId);
                if (employee) {
                    employee.usedLeaveDays += request.days;
                    employee.remainingLeaveDays -= request.days;
                }
            }
            
            this.saveData('leaveRequests', this.leaveRequests);
            this.saveData('employees', this.employees);
            return this.leaveRequests[index];
        }
        return null;
    }

    // Sample Employees
    const sampleEmployees = [
        {
            id: 1,
            name: '김철수',
            department: '개발팀',
            branch: '본사',
            position: '대리',
            email: 'kim@company.com',
            phone: '010-1234-5678',
            hireDate: '2022-01-15',
            annualLeaveDays: 15,
            usedLeaveDays: 0,
            remainingLeaveDays: 15
        },
        {
            id: 2,
            name: '이영희',
            department: '마케팅팀',
            branch: '강남점',
            position: '과장',
            email: 'lee@company.com',
            phone: '010-2345-6789',
            hireDate: '2021-03-20',
            annualLeaveDays: 20,
            usedLeaveDays: 0,
            remainingLeaveDays: 20
        },
        {
            id: 3,
            name: '박민수',
            department: '영업팀',
            branch: '부산점',
            position: '부장',
            email: 'park@company.com',
            phone: '010-3456-7890',
            hireDate: '2020-06-10',
            annualLeaveDays: 25,
            usedLeaveDays: 0,
            remainingLeaveDays: 25
        }
    ];

    const sampleRequests = [
        {
            id: 1,
            employeeId: 1,
            employeeName: '김철수',
            startDate: '2024-02-01',
            endDate: '2024-02-03',
            days: 3,
            reason: '개인 휴가',
            status: 'pending',
            requestDate: '2024-01-28'
        },
        {
            id: 2,
            employeeId: 2,
            employeeName: '이영희',
            startDate: '2024-02-05',
            endDate: '2024-02-05',
            days: 1,
            reason: '의료진료',
            status: 'pending',
            requestDate: '2024-01-30'
        },
        {
            id: 3,
            employeeId: 3,
            employeeName: '박민수',
            startDate: '2024-02-10',
            endDate: '2024-02-12',
            days: 3,
            reason: '가족 행사',
            status: 'pending',
            requestDate: '2024-02-01'
        },
        {
            id: 4,
            employeeId: 1,
            employeeName: '김철수',
            startDate: '2024-02-15',
            endDate: '2024-02-16',
            days: 2,
            reason: '개인 사정',
            status: 'pending',
            requestDate: '2024-02-05'
        },
        {
            id: 5,
            employeeId: 2,
            employeeName: '이영희',
            startDate: '2024-02-20',
            endDate: '2024-02-22',
            days: 3,
            reason: '여행',
            status: 'pending',
            requestDate: '2024-02-10'
        }
    ];

    this.employees = sampleEmployees;
    this.leaveRequests = sampleRequests;
    this.saveData('employees', this.employees);
    this.saveData('leaveRequests', this.leaveRequests);
}
                employeeId: 1,
                employeeName: '김철수',
                startDate: '2024-02-01',
                endDate: '2024-02-03',
                days: 3,
                reason: '개인 휴가',
                status: 'pending',
                requestDate: '2024-01-28'
            },
            {
                id: 5,
                employeeId: 2,
                employeeName: '이영희',
                startDate: '2024-02-05',
                endDate: '2024-02-05',
                days: 1,
                reason: '의료진료',
                status: 'pending',
                requestDate: '2024-01-30'
            },
            {
                id: 6,
                employeeId: 3,
                employeeName: '박민수',
                startDate: '2024-02-10',
                endDate: '2024-02-12',
                days: 3,
                reason: '가족 행사',
                status: 'pending',
                requestDate: '2024-02-01'
            }
        ];
            this.leaveRequests[index].approvedBy = approvedBy;
            
            // 승인된 경우 직원의 사용 연차일 업데이트
            if (status === 'approved') {
                const request = this.leaveRequests[index,
            {
                id: 4,
                employeeId: 1,
                employeeName: '김철수',
                startDate: '2024-02-01',
                endDate: '2024-02-03',
                days: 3,
                reason: '개인 휴가',
                status: 'pending',
                requestDate: '2024-01-28'
            },
            {
                id: 5,
                employeeId: 2,
                employeeName: '이영희',
                startDate: '2024-02-05',
                endDate: '2024-02-05',
                days: 1,
                reason: '의료진료',
                status: 'pending',
                requestDate: '2024-01-30'
            },
            {
                id: 6,
                employeeId: 3,
                employeeName: '박민수',
                startDate: '2024-02-10',
                endDate: '2024-02-12',
                days: 3,
                reason: '가족 행사',
                status: 'pending',
                requestDate: '2024-02-01'
            }
        ];
                const employee = this.employees.find(emp => emp.id === request.employeeId);
                if (employee) {
                    employee.usedLeaveDays += request.days;
                    employee.remainingLeaveDays -= request.days;
                }
            }
            
            this.saveData('leaveRequests', this.leaveRequests);
            this.saveData('employees', this.employees);
            return this.leaveRequests[index,
            {
                id: 4,
                employeeId: 1,
                employeeName: '김철수',
                startDate: '2024-02-01',
                endDate: '2024-02-03',
                days: 3,
                reason: '개인 휴가',
                status: 'pending',
                requestDate: '2024-01-28'
            },
            {
                id: 5,
                employeeId: 2,
                employeeName: '이영희',
                startDate: '2024-02-05',
                endDate: '2024-02-05',
                days: 1,
                reason: '의료진료',
                status: 'pending',
                requestDate: '2024-01-30'
            },
            {
                id: 6,
                employeeId: 3,
                employeeName: '박민수',
                startDate: '2024-02-10',
                endDate: '2024-02-12',
                days: 3,
                reason: '가족 행사',
                status: 'pending',
                requestDate: '2024-02-01'
            }
        ];
        }
        return null;
    }

    // 다음 ID 생성
    getNextId(type) {
        const data = type === 'employees' ? this.employees : this.leaveRequests;
        return data.length > 0 ? Math.max(...data.map(item => item.id)) + 1 : 1;
    }

    // 통계 데이터 가져오기
    getStatistics() {
        const totalEmployees = this.employees.length;
        const pendingRequests = this.leaveRequests.filter(req => req.status === 'pending').length;
        const approvedRequests = this.leaveRequests.filter(req => req.status === 'approved').length;
        const averageRemainingDays = totalEmployees > 0 
            ? Math.round(this.employees.reduce((sum, emp) => sum + emp.remainingLeaveDays, 0) / totalEmployees)
            : 0;

        return {
            totalEmployees,
            pendingRequests,
            approvedRequests,
            averageRemainingDays
        };
    }

    // 이번 달 통계
    getMonthlyStatistics() {
        const currentMonth = new Date().getMonth();
        const currentYear = new Date().getFullYear();
        
        const thisMonthRequests = this.leaveRequests.filter(req => {
            const requestDate = new Date(req.startDate);
            return requestDate.getMonth() === currentMonth && requestDate.getFullYear() === currentYear;
        });

        const usedThisMonth = thisMonthRequests
            .filter(req => req.status === 'approved')
            .reduce((sum, req) => sum + req.days, 0);
            
        const scheduledThisMonth = thisMonthRequests
            .filter(req => req.status === 'approved')
            .reduce((sum, req) => sum + req.days, 0);
            
        const pendingThisMonth = thisMonthRequests
            .filter(req => req.status === 'pending')
            .reduce((sum, req) => sum + req.days, 0);

        return {
            usedThisMonth,
            scheduledThisMonth,
            pendingThisMonth
        };
    }

    // 최근 연차 신청 목록
    getRecentRequests(limit = 5) {
        return this.leaveRequests
            .sort((a, b) => new Date(b.requestDate) - new Date(a.requestDate))
            .slice(0, limit);
    }

    // 승인 대기 목록
    getPendingRequests() {
        return this.leaveRequests.filter(req => req.status === 'pending');
    }

    // 데이터 내보내기
    exportData() {
        const data = {
            employees: this.employees,
            leaveRequests: this.leaveRequests,
            settings: this.settings,
            exportDate: new Date().toISOString()
        };
        
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `연차관리_데이터_${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    // 데이터 가져오기
    importData(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    this.employees = data.employees || [,
            {
                id: 4,
                employeeId: 1,
                employeeName: '김철수',
                startDate: '2024-02-01',
                endDate: '2024-02-03',
                days: 3,
                reason: '개인 휴가',
                status: 'pending',
                requestDate: '2024-01-28'
            },
            {
                id: 5,
                employeeId: 2,
                employeeName: '이영희',
                startDate: '2024-02-05',
                endDate: '2024-02-05',
                days: 1,
                reason: '의료진료',
                status: 'pending',
                requestDate: '2024-01-30'
            },
            {
                id: 6,
                employeeId: 3,
                employeeName: '박민수',
                startDate: '2024-02-10',
                endDate: '2024-02-12',
                days: 3,
                reason: '가족 행사',
                status: 'pending',
                requestDate: '2024-02-01'
            }
        ];
                    this.leaveRequests = data.leaveRequests || [,
            {
                id: 4,
                employeeId: 1,
                employeeName: '김철수',
                startDate: '2024-02-01',
                endDate: '2024-02-03',
                days: 3,
                reason: '개인 휴가',
                status: 'pending',
                requestDate: '2024-01-28'
            },
            {
                id: 5,
                employeeId: 2,
                employeeName: '이영희',
                startDate: '2024-02-05',
                endDate: '2024-02-05',
                days: 1,
                reason: '의료진료',
                status: 'pending',
                requestDate: '2024-01-30'
            },
            {
                id: 6,
                employeeId: 3,
                employeeName: '박민수',
                startDate: '2024-02-10',
                endDate: '2024-02-12',
                days: 3,
                reason: '가족 행사',
                status: 'pending',
                requestDate: '2024-02-01'
            }
        ];
                    this.settings = data.settings || this.settings;
                    
                    this.saveData('employees', this.employees);
                    this.saveData('leaveRequests', this.leaveRequests);
                    this.saveData('settings', this.settings);
                    
                    resolve(data);
                } catch (error) {
                    reject(error);
                }
            };
            reader.readAsText(file);
        });
    }
}

// 전역 인스턴스 생성
window.dataManager = new DataManager();







